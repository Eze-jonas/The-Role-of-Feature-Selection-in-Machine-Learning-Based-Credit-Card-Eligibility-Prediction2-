<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Prediction Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <h1>Credit Card Eligibility Prediction</h1>
        <h2>Model: Decision Tree</h2>

        <!-- Login Section -->
        <h3>Login</h3>
        <form id="login-form">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required><br>

            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter password" required><br>

            <button type="button" onclick="loginAndStoreToken()">Login</button>
        </form>
        <p id="login-status">Not logged in</p>

        <!-- Prediction Form -->
        <h3>Enter Customer Information</h3>
        <form id="prediction-form">

            <!-- Dropdowns for Binary Variables -->
            <label for="Owned_Realty">1. Do you own a realty?</label>
            <select id="Owned_Realty">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="education_type">2. What is your education type:</label>
        <select id="education_type" name="Education_Type" required>
            <option value="" selected disabled>-- Select an option --</option>
            <option value="Lower secondary">Lower secondary</option>
            <option value="Secondary / secondary special">Secondary / secondary special</option>
            <option value="Incomplete higher">Incomplete higher</option>
            <option value="Higher education">Higher education</option>
            <option value="Academic degree">Academic degree</option>
        </select><br><br>

            <label for="Owned_Mobile_Phone">3. Do you have a mobile phone?</label>
            <select id="Owned_Mobile_Phone">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Total_Bad_Debt">4. What is your total bad debt:</label>
            <input type="number" id="Total_Bad_Debt" step="any" required><br>

             <label for="Total_Good_Debt">5. What is your total good debt:</label>
            <input type="number" id="Total_Good_Debt" step="any" required><br>

            <label for="Applicant_Gender_M">6. is your gender male?:</label>
            <select id="Applicant_Gender_M">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Income_Type_Pensioner">7. Are you a pensioner?:</label>
            <select id="Income_Type_Pensioner">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Income_Type_Student">8. Are you a student?</label>
            <select id="Income_Type_Student">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Income_Type_Working">9. Do you have a job?:</label>
            <select id="Income_Type_Working">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Family_Status_Married">10. Are you married?:</label>
            <select id="Family_Status_Married">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>


            <label for="Family_Status_Separated">11. Were you married but separated now?:</label>
            <select id="Family_Status_Separated">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Family_Status_Single_not_married">12. Are you single?:</label>
            <select id="Family_Status_Single_not_married">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Housing_Type_Municipal_apartment">13. Are you living in a municipal apartment?:</label>
            <select id="Housing_Type_Municipal_apartment">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Housing_Type_With_parents">14. Are you living with your parents?:</label>
            <select id="Housing_Type_With_parents">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Cleaning_staff">15. Are you a cleaning staff?:</label>
            <select id="Job_Title_Cleaning_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Core_staff">16. Are you a core staff?:</label>
            <select id="Job_Title_Core_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_High_skill_tech_staff">17. Are you a high skill tech staff?:</label>
            <select id="Job_Title_High_skill_tech_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_IT_staff">18. Are you an IT staff?:</label>
            <select id="Job_Title_IT_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Laborers">19. Are you a laborer staff?:</label>
            <select id="Job_Title_Laborers">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Managers">20. Are you a manager staff?:</label>
            <select id="Job_Title_Managers">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Medicine_staff">21. Are you a medical staff?:</label>
            <select id="Job_Title_Medicine_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Realty_agents">22. Are you a realty agent?:</label>
            <select id="Job_Title_Realty_agents">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Secretaries">23. Are you a secretary staff?:</label>
            <select id="Job_Title_Secretaries">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <label for="Job_Title_Security_staff">24. Are you a security staff?:</label>
            <select id="Job_Title_Security_staff">
                <option value="" selected disabled>-- Select an option --</option>
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select><br>

            <button type="submit">Predict</button>
        </form>

        <h3>Prediction: <span id="prediction-result">Waiting...</span></h3>
    </div>

    <script>
        async function loginAndStoreToken() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            if (!username || !password) {
                alert("Please enter both username and password.");
                return;
            }

            try {
                const response = await fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ "username": username, "password": password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem("jwt_token", data.access_token);
                    document.getElementById("login-status").innerText = "Logged in as: " + username;
                } else {
                    alert("Login failed: " + data.message);
                }
            } catch (error) {
                alert("Request failed: " + error.message);
            }
        }

        document.getElementById("prediction-form").addEventListener("submit", async function(event) {
            event.preventDefault();

            let data = {};
            document.querySelectorAll("#prediction-form select, #prediction-form input").forEach(input => {
                data[input.id] = input.type === "number" ? parseFloat(input.value) : (input.value === "Yes" ? 1.0 : 0.0);
            });

            const token = localStorage.getItem("jwt_token");
            if (!token) {
                alert("Please log in first.");
                return;
            }

            try {
                const response = await fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById("prediction-result").innerText = result.Status;
            } catch (error) {
                alert("Request failed: " + error.message);
            }
        });
    </script>

</body>
</html>
